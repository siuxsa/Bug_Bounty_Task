<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Pentest Checklist</title>
  <style>
    :root {
      --bg: #0f1115;
      --panel: #161a22;
      --muted: #98a2b3;
      --text: #e6eaf2;
      --accent: #7c5cff;
      --accent-2: #22c55e;
      --danger: #ef4444;
      --warn: #f59e0b;
      --border: #232838;
      --chip: #1d2330;
      --shadow: 0 10px 30px rgba(0,0,0,.4);
    }
    * { box-sizing: border-box; }
    html, body {
      height: 100%;
      margin: 0;
      background: radial-gradient(1200px 800px at 80% -10%, rgba(124,92,255,.12), transparent 60%), var(--bg);
      color: var(--text);
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji", "Segoe UI Emoji";
    }
    .container {
      max-width: 1100px;
      margin: 24px auto 80px;
      padding: 0 16px;
    }
    header {
      display: grid;
      grid-template-columns: 1fr auto;
      gap: 16px;
      align-items: center;
      margin-bottom: 16px;
    }
    h1 { font-size: 24px; font-weight: 800; letter-spacing: .2px; margin: 0; }
    .card {
      background: linear-gradient(180deg, rgba(255,255,255,.02), rgba(255,255,255,.00));
      border: 1px solid var(--border);
      border-radius: 16px;
      box-shadow: var(--shadow);
    }
    .row { display: flex; gap: 10px; align-items: center; }
    .col { display: grid; gap: 10px; }
    .controls { padding: 16px; }
    label { font-size: 12px; color: var(--muted); }
    input, select, button, textarea {
      background: #0f1420;
      color: var(--text);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 10px 12px;
      outline: none;
    }
    input:focus, select:focus, textarea:focus { border-color: var(--accent); box-shadow: 0 0 0 3px rgba(124,92,255,.2); }
    button { cursor: pointer; border-radius: 12px; font-weight: 600; }
    .btn { background: var(--panel); }
    .btn.primary { background: var(--accent); border-color: transparent; }
    .btn.success { background: var(--accent-2); border-color: transparent; color: #06280f; }
    .btn.ghost { background: transparent; }
    .btn.danger { background: var(--danger); border-color: transparent; }
    .btn.warn { background: var(--warn); border-color: transparent; color: #1a1302; }
    .stack { display: grid; gap: 6px; }
    .grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 16px;
    }
    @media (max-width: 900px) { .grid { grid-template-columns: 1fr; } }

    /* Task list */
    .section { margin-top: 18px; }
    .section h2 { font-size: 14px; letter-spacing: .3px; color: var(--muted); margin: 0 0 8px; text-transform: uppercase; }
    .task-list { list-style: none; margin: 0; padding: 0; }
    .task { display: grid; grid-template-columns: auto 1fr auto; gap: 10px; align-items: center; padding: 10px 12px; border-top: 1px solid var(--border); }
    .task:first-child { border-top: none; }
    .task .title { font-weight: 600; }
    .task .meta { font-size: 12px; color: var(--muted); }
    .task .category { padding: 4px 8px; background: var(--chip); border: 1px solid var(--border); border-radius: 999px; font-size: 11px; text-transform: uppercase; letter-spacing: .5px; }
    .task.done .title { text-decoration: line-through; opacity: .6; }
    .actions { display: flex; gap: 6px; }
    .checkbox { width: 22px; height: 22px; border: 2px solid var(--border); border-radius: 6px; display: inline-grid; place-items: center; background: #0f1420; }
    .checkbox.checked { border-color: var(--accent-2); background: rgba(34,197,94,.08); }
    .checkbox svg { width: 16px; height: 16px; }
    .muted { color: var(--muted); }

    /* Footer summary */
    footer {
      position: sticky;
      bottom: 0;
      background: linear-gradient(0deg, rgba(15,17,21,.9), rgba(15,17,21,.6));
      backdrop-filter: blur(6px);
      border-top: 1px solid var(--border);
      padding: 12px 16px;
      display: grid;
      grid-template-columns: 1fr auto;
      align-items: center;
      gap: 8px;
    }
    .summary { display: flex; gap: 16px; font-size: 14px; }
    .summary b { font-size: 15px; }
    .next-list { display: flex; gap: 8px; flex-wrap: wrap; }
    .pill { border: 1px dashed var(--border); padding: 6px 10px; border-radius: 999px; font-size: 12px; color: var(--muted); }

    .divider { height: 1px; background: var(--border); margin: 8px 0; }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>üõ°Ô∏è Pentest Checklist</h1>
      <div class="row">
        <button class="btn warn" id="exportBtn" title="Export all targets & tasks as JSON">Export</button>
        <label for="importFile" class="btn">Import</label>
        <input id="importFile" type="file" accept="application/json" style="display:none" />
      </div>
    </header>

    <section class="card controls">
      <div class="grid">
        <div class="col">
          <div class="stack">
            <label>Target</label>
            <div class="row">
              <select id="targetSelect" style="flex: 1 1 auto"></select>
              <input id="newTarget" placeholder="Add target (e.g., example.com or 10.0.0.5)" style="flex: 2 1 auto" />
              <button class="btn primary" id="addTargetBtn">Add</button>
              <button class="btn danger" id="delTargetBtn" title="Delete current target">Delete</button>
            </div>
            <small class="muted">Targets are saved locally in your browser (no server).</small>
          </div>

          <div class="stack section">
            <h2>Add Task</h2>
            <div class="row">
              <input id="taskInput" placeholder="Task title (e.g., Run subfinder)" style="flex: 3" />
              <select id="categorySelect" style="flex: 1">
                <option>Recon</option>
                <option>Enumeration</option>
                <option>Scanning</option>
                <option>Web Vulns</option>
                <option>Auth</option>
                <option>Cloud</option>
                <option>Mobile</option>
                <option>Reporting</option>
                <option>Misc</option>
              </select>
              <button class="btn success" id="addTaskBtn">+ Add</button>
            </div>
            <textarea id="notesInput" rows="2" placeholder="Optional notes, commands, or context"></textarea>
            <div class="row">
              <button class="btn" id="addTemplateBtn" title="Add common pentest tasks for this target">Add from Template</button>
              <button class="btn" id="clearDoneBtn">Clear Completed</button>
              <div style="flex:1"></div>
              <input id="filterInput" placeholder="Filter tasks (text or #category)"/>
            </div>
          </div>
        </div>

        <div class="col">
          <div class="stack section">
            <h2>Quick Tips (optional)</h2>
            <div class="row" style="flex-wrap:wrap">
              <span class="pill">#Recon = discovery</span>
              <span class="pill">#Scanning = nmap/httpx</span>
              <span class="pill">#Web Vulns = XSS/SSRF/RCE</span>
              <span class="pill">#Auth = login/session</span>
              <span class="pill">#Reporting = evidence</span>
            </div>
            <div class="divider"></div>
            <div class="muted">Use <b>#Category</b> in filter (e.g., <code>#Recon</code>) or any keyword. Click the square to check/uncheck. All data persists to <code>localStorage</code>.</div>
          </div>
        </div>
      </div>
    </section>

    <section class="card section">
      <div class="controls">
        <h2>Tasks</h2>
        <ul id="taskList" class="task-list"></ul>
      </div>
    </section>
  </div>

  <footer>
    <div class="summary" id="summary"></div>
    <div class="next-list" id="nextList" title="Pending tasks (what to do next)"></div>
  </footer>

  <script>
    // --- Storage helpers ---
    const LS_KEY = 'pentestChecklist.v1';
    function loadState() {
      try { return JSON.parse(localStorage.getItem(LS_KEY)) || { targets: {}, order: [] }; } catch { return { targets: {}, order: [] }; }
    }
    function saveState() { localStorage.setItem(LS_KEY, JSON.stringify(state)); }

    let state = loadState();

    // --- Elements ---
    const targetSelect = document.getElementById('targetSelect');
    const newTarget = document.getElementById('newTarget');
    const addTargetBtn = document.getElementById('addTargetBtn');
    const delTargetBtn = document.getElementById('delTargetBtn');
    const taskInput = document.getElementById('taskInput');
    const notesInput = document.getElementById('notesInput');
    const categorySelect = document.getElementById('categorySelect');
    const addTaskBtn = document.getElementById('addTaskBtn');
    const addTemplateBtn = document.getElementById('addTemplateBtn');
    const taskList = document.getElementById('taskList');
    const filterInput = document.getElementById('filterInput');
    const exportBtn = document.getElementById('exportBtn');
    const importFile = document.getElementById('importFile');
    const clearDoneBtn = document.getElementById('clearDoneBtn');
    const summary = document.getElementById('summary');
    const nextList = document.getElementById('nextList');

    // --- Utilities ---
    const uid = () => Math.random().toString(36).slice(2)+Date.now().toString(36);
    const nowISO = () => new Date().toISOString();
    const esc = (s='') => s.replace(/[&<>"']/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;','\'':'&#39;'}[c]));

    // --- Targets ---
    function ensureDefaultTarget() {
      if (!state.order.length) {
        state.order.push('demo-target');
        state.targets['demo-target'] = [];
        saveState();
      }
    }
    function renderTargets() {
      targetSelect.innerHTML = state.order.map(t => `<option value="${esc(t)}">${esc(t)}</option>`).join('');
      if (!state.order.includes(targetSelect.value)) {
        targetSelect.value = state.order[0] || '';
      }
    }
    function addTarget(name) {
      if (!name) return;
      if (state.order.includes(name)) { targetSelect.value = name; render(); return; }
      state.order.push(name);
      state.targets[name] = [];
      saveState();
      render();
    }
    function deleteTarget(name) {
      if (!name) return;
      if (!confirm(`Delete target "${name}" and all its tasks?`)) return;
      delete state.targets[name];
      state.order = state.order.filter(t => t !== name);
      if (!state.order.length) ensureDefaultTarget();
      saveState();
      render();
    }

    // --- Tasks ---
    function addTask(target, {title, notes='', category='Misc'}) {
      if (!title) return;
      const t = { id: uid(), title, notes, category, done:false, createdAt: nowISO(), updatedAt: nowISO() };
      state.targets[target].unshift(t);
      saveState();
      renderTasks();
    }

    function addTemplateTasks(target) {
      const template = [
        { title: 'Gather scope & subdomains (subfinder + assetfinder)', category: 'Recon' },
        { title: 'Crawl & archive (katana, waybackurls, waymore)', category: 'Recon' },
        { title: 'Probe live hosts (httpx -mc 200,302)', category: 'Scanning' },
        { title: 'Service scan (nmap top-1000 + scripts)', category: 'Scanning' },
        { title: 'Tech fingerprinting (wappalyzer/whatweb)', category: 'Enumeration' },
        { title: 'Parameter discovery (gf, arjun)', category: 'Enumeration' },
        { title: 'Auth/session tests (CORS, JWT, CSRF, 2FA bypass)', category: 'Auth' },
        { title: 'Common web vulns (XSS/SQLi/SSRF/RCE/IDOR)', category: 'Web Vulns' },
        { title: 'Business logic & rate limits', category: 'Web Vulns' },
        { title: 'Sensitive files & misconfig (robots.txt, .git, backups)', category: 'Web Vulns' },
        { title: 'Cloud exposures (S3/GCS/Azure, public buckets/keys)', category: 'Cloud' },
        { title: 'Evidence & screenshots', category: 'Reporting' },
        { title: 'Write report with impact & PoC', category: 'Reporting' },
      ];
      template.forEach(item => addTask(target, item));
    }

    function toggleTask(target, id) {
      const list = state.targets[target];
      const t = list.find(x => x.id === id);
      if (!t) return;
      t.done = !t.done;
      t.updatedAt = nowISO();
      saveState();
      renderTasks();
    }

    function deleteTask(target, id) {
      state.targets[target] = state.targets[target].filter(x => x.id !== id);
      saveState();
      renderTasks();
    }

    function editTask(target, id, fields) {
      const t = state.targets[target].find(x => x.id === id);
      if (!t) return;
      Object.assign(t, fields, { updatedAt: nowISO() });
      saveState();
      renderTasks();
    }

    function clearCompleted(target) {
      state.targets[target] = state.targets[target].filter(x => !x.done);
      saveState();
      renderTasks();
    }

    // --- Rendering ---
    function currentTarget() { return targetSelect.value; }

    function renderTasks() {
      const target = currentTarget();
      const q = filterInput.value.trim();
      let list = state.targets[target] || [];

      if (q) {
        if (q.startsWith('#')) {
          const tag = q.slice(1).toLowerCase();
          list = list.filter(t => (t.category||'').toLowerCase().includes(tag));
        } else {
          const k = q.toLowerCase();
          list = list.filter(t => (t.title+" "+(t.notes||'')+" "+(t.category||'')).toLowerCase().includes(k));
        }
      }

      taskList.innerHTML = list.map(t => taskItemHTML(t)).join('');
      attachTaskHandlers();
      renderFooter();
    }

    function taskItemHTML(t) {
      return `
        <li class="task ${t.done ? 'done' : ''}" data-id="${t.id}">
          <button class="checkbox ${t.done ? 'checked' : ''}" data-action="toggle" title="Mark done/undone">
            ${t.done ? checkIcon() : ''}
          </button>
          <div>
            <div class="title">${esc(t.title)}</div>
            <div class="meta">
              <span class="category">${esc(t.category||'Misc')}</span>
              ${t.notes ? `<span> ‚Ä¢ ${esc(t.notes)}</span>` : ''}
            </div>
          </div>
          <div class="actions">
            <button class="btn" data-action="edit">Edit</button>
            <button class="btn danger" data-action="delete">Del</button>
          </div>
        </li>`;
    }

    function checkIcon(){
      return `<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M5 13l4 4L19 7" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/></svg>`;
    }

    function attachTaskHandlers() {
      [...taskList.querySelectorAll('.task')].forEach(el => {
        const id = el.getAttribute('data-id');
        el.querySelector('[data-action="toggle"]').onclick = () => toggleTask(currentTarget(), id);
        el.querySelector('[data-action="delete"]').onclick = () => deleteTask(currentTarget(), id);
        el.querySelector('[data-action="edit"]').onclick = () => openEditor(id);
      });
    }

    function openEditor(id) {
      const target = currentTarget();
      const t = state.targets[target].find(x => x.id === id);
      if (!t) return;
      const title = prompt('Edit title', t.title);
      if (title === null) return; // cancel
      const category = prompt('Edit category', t.category||'Misc');
      if (category === null) return;
      const notes = prompt('Edit notes', t.notes||'');
      if (notes === null) return;
      editTask(target, id, { title, category, notes });
    }

    function renderFooter() {
      const target = currentTarget();
      const list = state.targets[target] || [];
      const done = list.filter(t => t.done).length;
      const pending = list.length - done;
      summary.innerHTML = `<span>Target: <b>${esc(target)}</b></span><span>Tasks: <b>${list.length}</b></span><span>Done: <b>${done}</b></span><span>Pending: <b>${pending}</b></span>`;

      // what to do next = first 6 pending tasks (most recent first)
      const next = list.filter(t => !t.done).slice(0, 6);
      nextList.innerHTML = next.map(t => `<span class="pill" title="${esc(t.title)}">${esc(t.category||'Misc')}: ${esc(t.title).slice(0,36)}${t.title.length>36?'‚Ä¶':''}</span>`).join('');
    }

    function render() {
      renderTargets();
      renderTasks();
    }

    // --- Events ---
    addTargetBtn.onclick = () => { const name = newTarget.value.trim(); if (name) { addTarget(name); newTarget.value=''; } };
    delTargetBtn.onclick = () => deleteTarget(currentTarget());

    addTaskBtn.onclick = () => {
      const title = taskInput.value.trim();
      const notes = notesInput.value.trim();
      const category = categorySelect.value;
      if (!title) return;
      addTask(currentTarget(), { title, notes, category });
      taskInput.value = '';
      notesInput.value = '';
      taskInput.focus();
    };
    taskInput.addEventListener('keydown', (e)=>{ if(e.key==='Enter'){ addTaskBtn.click(); }});

    addTemplateBtn.onclick = () => addTemplateTasks(currentTarget());
    clearDoneBtn.onclick = () => clearCompleted(currentTarget());
    targetSelect.onchange = () => renderTasks();
    filterInput.oninput = () => renderTasks();

    exportBtn.onclick = () => {
      const blob = new Blob([JSON.stringify(state, null, 2)], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url; a.download = 'pentest-checklist.json'; a.click();
      setTimeout(()=>URL.revokeObjectURL(url), 5000);
    };

    importFile.onchange = (e) => {
      const file = e.target.files[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = () => {
        try {
          const data = JSON.parse(reader.result);
          if (!data || !data.targets || !data.order) throw new Error('Invalid file');
          state = data; saveState(); render();
          alert('Imported successfully');
        } catch (err) { alert('Import failed: '+err.message); }
      };
      reader.readAsText(file);
    };

    // --- Init ---
    ensureDefaultTarget();
    render();
  </script>
</body>
</html>
